<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Learning App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #4CAF50;
            padding: 10px;
            color: white;
            display: flex;
            align-items: center;
        }
        nav {
            display: flex;
            align-items: center;
        }
        select {
            margin-left: 10px;
            padding: 5px;
        }
        .card {
            width: 300px;
            height: auto;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #555;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .red {
            color: red;
        }
        .gray {
            color: gray;
        }
        input {
            margin-top: 10px;
            padding: 5px;
            width: 80%;
        }
    </style>
</head>
<body>

<header>
    <nav>
        <label for="mode">Mode:</label>
        <select id="mode">
            <option value="insert" selected>Insert word</option>
            <option value="translate">Translate</option>
            <option value="conjugate">Conjugate</option>
        </select>

        <label for="language">Language:</label>
        <select id="language">
            <option value="en-sp" selected>EN-SP</option>
            <option value="sp-en">SP-EN</option>
            <option value="ru-en">RU-EN</option>
            <option value="en-ru">EN-RU</option>
        </select>
    </nav>
</header>

<div class="card">
    <span class="sentence"></span>
    <!-- <span class="translation hidden"></span> -->
    <input type="text" id="userInput" placeholder="Your guess here">
    <button id="submitBtn">Submit</button>
    <div id="message"></div>
    <div class="counter">
        <span>Total Words: <span id="totalWords">0</span></span><br>
        <span>Correct Answers: <span id="correctCount">0</span></span><br>
        <span>Incorrect Answers: <span id="incorrectCount">0</span></span>
    </div>
</div>

<script>

    let dictionary = {};
    let totalWords = 0;
    let correctCount = 0;
    let incorrectCount = 0;
    let currentWord = '';
    let answer = '';
    let baseLang = '';
    let learnLang = 'sp';
    const modeSelect = document.getElementById('mode');
    const languageSelect = document.getElementById('language');
    const sentenceSpan = document.querySelector('.sentence');
    // const translationSpan = document.querySelector('.translation');
    const userInput = document.getElementById('userInput');
    const messageDiv = document.getElementById('message');

    document.addEventListener('DOMContentLoaded', loadDictionary);

    function loadDictionary() {
        fetch('/api/dictionary')
            .then(response => response.json())
            .then(data => {
                dictionary = data;
                loadNewContent(); // Load content after dictionary is fetched
            });
    }

    function selectRandomEntry(language) {
        const entries = dictionary[language];
        const randomIndex = Math.floor(Math.random() * entries.length);
        return entries[randomIndex];
    }

    function displayContent(entry) {
        const prettyJson = JSON.stringify(entry.translations, null, 2);
        console.log(`${prettyJson}, ${baseLang}, ${learnLang}`);
        if (modeSelect.value === 'insert') {
            sentenceSpan.innerHTML = entry.sentence.replace(`__${entry.word}__`, `<span class="gray">${entry.translations[learnLang].translation}</span>`);
            answer = entry.word;
            // translationSpan.classList.add('hidden');
        } else if (modeSelect.value === 'translate') {
            sentenceSpan.innerHTML = entry.sentence.replace(/__(.*?)__/g, `<span class="red">$1</span>`);
            answer = entry.translations[learnLang].translation;
            // translationSpan.innerHTML = `Translation: ${entry.translations[learnLang].translation}`;
            // translationSpan.classList.remove('hidden');
        } else {
            sentenceSpan.innerHTML = "Not implemented yet";
            translationSpan.classList.add('hidden');
        }
        totalWords++;
        updateCounters();
    }

    function updateCounters() {
        document.getElementById('totalWords').innerText = totalWords;
        document.getElementById('correctCount').innerText = correctCount;
        document.getElementById('incorrectCount').innerText = incorrectCount;
    }

    function submitAnswer() {
        const userAnswer = userInput.value.toLowerCase().trim();
        if (userAnswer === answer.toLowerCase()) {
            messageDiv.innerText = "Correct!";
            correctCount++;
        } else {
            messageDiv.innerText = `Incorrect! The correct word was: ${answer}`;
            incorrectCount++;
        }
        updateCounters();
        userInput.value = '';
        loadNewContent();
    }

    function loadNewContent() {
        baseLang = languageSelect.value.slice(0, 2);
        // const learnLang = 'sp'; // Default value
        if (modeSelect.value === 'translate') {
            learnLang = languageSelect.value.slice(3, 5);
        } else if (modeSelect.value === 'insert') {
            learnLang = languageSelect.value.slice(3, 5);
        }
        // const language = modeSelect.value === 'conjugate' ? languageSelect.value.slice(0, 2) : languageSelect.value.slice(0, 2);
        const entry = selectRandomEntry(baseLang);
        displayContent(entry);
    }

    modeSelect.addEventListener('change', function() {
        loadNewContent();
        if (this.value === 'conjugate') {
            languageSelect.innerHTML = `
                <option value="en">EN</option>
                <option value="sp">SP</option>
                <option value="ru">RU</option>
            `;
        } else {
            languageSelect.innerHTML = `
                <option value="en-sp" selected>EN-SP</option>
                <option value="sp-en">SP-EN</option>
                <option value="ru-en">RU-EN</option>
                <option value="en-ru">EN-RU</option>
            `;
        }
    });

    languageSelect.addEventListener('change', loadNewContent);
    document.getElementById('submitBtn').addEventListener('click', submitAnswer);

    // Initial content load
    loadNewContent();
</script>

</body>
</html>

